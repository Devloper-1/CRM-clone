<!-- Dashboard.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRM - Dashboard</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Global config -->
  <script src="/frontend/js/config.js" defer></script>

  <!-- API helper -->
  <script src="/frontend/js/api.js" defer></script>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Dashboard JS -->
  <script src="/frontend/js/dashboard.js" defer></script>

</head>

<body class="m-0 bg-gray-100 text-gray-800">

  <!-- Overlay -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-10 hidden md:hidden"></div>

  <!-- Top bar for mobile -->
  <div class="flex w-full bg-white p-3 items-center gap-4 fixed md:hidden z-10">
    <button id="menu-toggle" class="p-2 bg-gray-500 text-white md:hidden">‚ò∞</button>
    <h1 class="text-lg font-semibold text-black">Dashboard</h1>
    <button id="logoutBtnTop" class="ml-auto text-black">Logout</button>
  </div>

  <!-- Sidebar -->
  <div id="sidebar"
    class="w-56 bg-[#2c3e50] text-white p-8 h-screen fixed top-0 left-0 transition-transform duration-300 ease-in-out -translate-x-full md:translate-x-0 z-20">
    <h2 class="mb-5 text-3xl text-center font-bold">SMART-CRM</h2>
    <ul class="space-y-4">
      <li><a href="#" class="block px-6 py-2 rounded bg-[#1abc9c]">Dashboard</a></li>
      <li><a href="clients.html" class="block px-6 py-3 hover:bg-[#34495e]">Clients</a></li>
      <li><a href="users.html" class="block px-6 py-3 hover:bg-[#34495e]">Users</a></li>
      <li><a href="tasks.html" class="block px-6 py-3 hover:bg-[#34495e]">Tasks</a></li>
      <li><a href="payments.html" class="block px-6 py-3 hover:bg-[#34495e]">Payments</a></li>
      <button id="logoutBtn" class=" block px-6 text-2xl py-3 rounded bg-red-500 "><a
          href="login.html">Logout</a></button>
    </ul>
  </div>

  <!-- Main content -->
  <div class="md:ml-52  p-5 pt-16 md:pt-5  ">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-10  max-w-4xl mx-auto mb-10 ">

      <div class="bg-white rounded-lg shadow p-10 text-center">
        <a href="clients.html">
          <h2 class="text-lg font-semibold text-gray-600 mb-2">Total Clients</h2>
          <p class="text-5xl font-bold text-[#1abc9c] ">üë•</p>
        </a>
      </div>


      <div class="bg-white rounded-lg shadow p-10 text-center">
        <h2 class="text-lg font-semibold text-gray-600 mb-2 ">Pending Tasks</h2>
        <p class="text-5xl font-bold text-yellow-500">üìù</p>
      </div>
      <div class="bg-white rounded-lg shadow p-10 text-center">
        <h2 class="text-lg font-semibold text-gray-600 mb-2 ">Payments Due</h2>
        <p class="text-5xl font-bold text-red-500">üí∞</p>
      </div>
    </div>
    <!-- Main content -->
    <div class="p-5 mt-16 md:mt-5 md:ml-0">
      <div class="bg-white rounded-lg shadow p-5 w-full md:w-auto mx-auto h-96 md:h-[500px]">
        <h2 class="text-lg font-semibold text-gray-600 mb-4 text-center">Overview</h2>
        <canvas id="clientsChart" class="w-full h-full "></canvas>
      </div>
    </div>





    <!-- Script -->
    <script>
      // ====== Sidebar toggle ======
      const sidebar = document.getElementById("sidebar");
      const toggleBtn = document.getElementById("menu-toggle");
      const overlay = document.getElementById("overlay");

      toggleBtn?.addEventListener("click", () => {
        sidebar.classList.toggle("-translate-x-full");
        overlay.classList.toggle("hidden");
      });

      overlay?.addEventListener("click", () => {
        sidebar.classList.add("-translate-x-full");
        overlay.classList.add("hidden");
      });

      // ====== Logout buttons ======
      function logout() {
        sessionStorage.clear();
        window.location.href = "/frontend/login.html";
      }

      document.getElementById("logoutBtnTop")?.addEventListener("click", logout);
      document.getElementById("logoutBtnSidebar")?.addEventListener("click", logout);

      // ====== Chart ======
      const token = sessionStorage.getItem("token");
      if (!token) window.location.href = "/frontend/login.html";

      const headers = { "Authorization": `Bearer ${token}` };

      async function loadChart() {
        try {
          const [clientsRes, usersRes, tasksRes, paymentsRes] = await Promise.all([
            fetch("http://127.0.0.1:8000/clients/", { headers }),
            fetch("http://127.0.0.1:8000/users/", { headers }),
            fetch("http://127.0.0.1:8000/tasks/", { headers }),
            fetch("http://127.0.0.1:8000/payments/", { headers }),
          ]);

          const [clients, users, tasks, payments] = await Promise.all([
            clientsRes.ok ? clientsRes.json() : [],
            usersRes.ok ? usersRes.json() : [],
            tasksRes.ok ? tasksRes.json() : [],
            paymentsRes.ok ? paymentsRes.json() : [],
          ]);

          const counts = [clients.length, users.length, tasks.length, payments.length];

          const canvas = document.getElementById("clientsChart");
          const ctx = canvas.getContext("2d");
          canvas.height = 300;

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: ["Clients", "Users", "Tasks", "Payments"],
              datasets: [{
                label: "Counts",
                data: counts,
                backgroundColor: ["#1abc9c", "#3498db", "#f1c40f", "#e74c3c"]
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { display: false } },
              scales: { y: { beginAtZero: true } }
            }
          });

        } catch (err) {
          console.error("Chart error:", err);
        }
      }

      loadChart();
    </script>

</html>